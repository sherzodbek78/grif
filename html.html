<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Head Ball Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #4a90e2; font-family: 'Arial Black', sans-serif; touch-action: none; }
        canvas { display: block; background: linear-gradient(#87CEEB, #E0F6FF); }
        .score { 
            position: absolute; top: 30px; width: 100%; text-align: center; 
            font-size: 50px; color: white; text-shadow: 4px 4px 0px #222;
            display: flex; justify-content: center; gap: 30px;
        }
        .controls { position: absolute; bottom: 40px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; box-sizing: border-box; }
        .btn { 
            width: 90px; height: 90px; background: rgba(0,0,0,0.4); border: 4px solid white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 45px; color: white; pointer-events: auto; user-select: none;
        }
        .btn:active { background: rgba(255,255,255,0.6); transform: scale(0.9); }
    </style>
</head>
<body>

    <div class="score">
        <span id="p1Score">0</span>
        <span style="font-size: 30px; align-self: center;">VS</span>
        <span id="botScore">0</span>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div style="display: flex; gap: 25px; pointer-events: none;">
            <div class="btn" id="btnLeft" style="pointer-events: auto;">←</div>
            <div class="btn" id="btnRight" style="pointer-events: auto;">→</div>
        </div>
        <div class="btn" id="btnJump">↑</div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const gravity = 0.7;
    const friction = 0.98;
    const groundY = canvas.height - 60;

    let p1 = { x: 150, y: 0, w: 80, h: 80, color: '#ff4757', dy: 0, dx: 0, score: 0, jumping: false, side: 'right' };
    let bot = { x: canvas.width - 230, y: 0, w: 80, h: 80, color: '#2e86de', dy: 0, dx: 0, score: 0, jumping: false, side: 'left' };
    let ball = { x: canvas.width / 2, y: 100, r: 20, dx: 0, dy: 0, angle: 0 };

    let keys = { left: false, right: false, jump: false };

    // Events
    const setKey = (k, v) => keys[k] = v;
    document.getElementById('btnLeft').ontouchstart = () => setKey('left', true);
    document.getElementById('btnLeft').ontouchend = () => setKey('left', false);
    document.getElementById('btnRight').ontouchstart = () => setKey('right', true);
    document.getElementById('btnRight').ontouchend = () => setKey('right', false);
    document.getElementById('btnJump').ontouchstart = () => setKey('jump', true);
    document.getElementById('btnJump').ontouchend = () => setKey('jump', false);

    window.onkeydown = (e) => {
        if(e.key === 'ArrowLeft') setKey('left', true);
        if(e.key === 'ArrowRight') setKey('right', true);
        if(e.key === 'ArrowUp') setKey('jump', true);
    };
    window.onkeyup = (e) => {
        if(e.key === 'ArrowLeft') setKey('left', false);
        if(e.key === 'ArrowRight') setKey('right', false);
        if(e.key === 'ArrowUp') setKey('jump', false);
    };

    function drawPlayer(p) {
        ctx.save();
        ctx.translate(p.x + p.w/2, p.y + p.h/2);
        
        // Tana (Kallasi)
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.roundRect(-p.w/2, -p.h/2, p.w, p.h, 20);
        ctx.fill();
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 3;
        ctx.stroke();

        // Ko'zlar
        let eyeOffset = p.side === 'right' ? 15 : -15;
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(eyeOffset, -10, 12, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(eyeOffset + (p.side === 'right' ? 4: -4), -10, 5, 0, Math.PI*2);
        ctx.fill();

        // Poyabzal
        ctx.fillStyle = "#333";
        ctx.beginPath();
        ctx.roundRect(p.side === 'right' ? 0 : -35, 30, 35, 15, 5);
        ctx.fill();

        ctx.restore();
    }

    function drawGoal(side) {
        ctx.strokeStyle = "white";
        ctx.lineWidth = 8;
        let gx = side === 'left' ? 0 : canvas.width - 15;
        ctx.strokeRect(gx, groundY - 160, 15, 160);
        
        // To'r (Net)
        ctx.globalAlpha = 0.3;
        ctx.fillStyle = "white";
        ctx.fillRect(gx, groundY - 160, 15, 160);
        ctx.globalAlpha = 1.0;
    }

    function update() {
        // Player movement
        if (keys.left) { p1.dx = -7; p1.side = 'left'; }
        else if (keys.right) { p1.dx = 7; p1.side = 'right'; }
        else p1.dx *= 0.8;

        if (keys.jump && !p1.jumping) { p1.dy = -16; p1.jumping = true; }

        // Smart Bot AI
        let targetX = ball.x - bot.w/2;
        if (ball.x > canvas.width / 2) {
            if (bot.x < targetX - 10) bot.dx = 5.5;
            else if (bot.x > targetX + 10) bot.dx = -5.5;
            if (ball.y < bot.y && Math.abs(ball.x - bot.x) < 50 && !bot.jumping) {
                bot.dy = -16; bot.jumping = true;
            }
        } else {
            // Darvozani himoya qilish
            if (bot.x < canvas.width - 150) bot.dx = 4;
        }
        bot.side = ball.x < bot.x ? 'left' : 'right';

        // Physics
        [p1, bot].forEach(p => {
            p.dy += gravity;
            p.y += p.dy;
            p.x += p.dx;
            if (p.y > groundY - p.h) {
                p.y = groundY - p.h;
                p.dy = 0;
                p.jumping = false;
            }
            if(p.x < 0) p.x = 0;
            if(p.x > canvas.width - p.w) p.x = canvas.width - p.w;
        });

        // Ball Physics
        ball.dy += 0.5;
        ball.x += ball.dx;
        ball.y += ball.dy;
        ball.angle += ball.dx * 0.05;

        // Ground bounce
        if (ball.y > groundY - ball.r) {
            ball.y = groundY - ball.r;
            ball.dy *= -0.8;
            ball.dx *= 0.95;
        }
        // Wall bounce
        if (ball.x < ball.r || ball.x > canvas.width - ball.r) {
            ball.dx *= -0.7;
            ball.x = ball.x < ball.r ? ball.r : canvas.width - ball.r;
        }

        // Collision detection
        [p1, bot].forEach(p => {
            let pCenterX = p.x + p.w/2;
            let pCenterY = p.y + p.h/2;
            let dist = Math.hypot(ball.x - pCenterX, ball.y - pCenterY);
            
            if (dist < ball.r + p.w/2) {
                ball.dy = -10;
                ball.dx = (ball.x - pCenterX) * 0.4;
                // Kuchliroq zarba agar o'yinchi harakatda bo'lsa
                ball.dx += p.dx * 0.5;
            }
        });

        // Scoring
        if (ball.y > groundY - 170) {
            if (ball.x < 20) { bot.score++; reset(); }
            if (ball.x > canvas.width - 20) { p1.score++; reset(); }
        }

        document.getElementById('p1Score').innerText = p1.score;
        document.getElementById('botScore').innerText = bot.score;
    }

    function reset() {
        ball.x = canvas.width / 2;
        ball.y = 100;
        ball.dx = 0; ball.dy = 0;
        p1.x = 150; bot.x = canvas.width - 230;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // O'yingoh (Grass)
        ctx.fillStyle = "#2ecc71";
        ctx.fillRect(0, groundY, canvas.width, 60);
        ctx.fillStyle = "#27ae60";
        for(let i=0; i<canvas.width; i+=100) ctx.fillRect(i, groundY, 50, 60);

        drawGoal('left');
        drawGoal('right');

        // Ball
        ctx.save();
        ctx.translate(ball.x, ball.y);
        ctx.rotate(ball.angle);
        ctx.fillStyle = "white";
        ctx.beginPath(); ctx.arc(0, 0, ball.r, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle = "black"; ctx.lineWidth = 2; ctx.stroke();
        // To'p chiziqlari
        ctx.beginPath(); ctx.moveTo(-ball.r, 0); ctx.lineTo(ball.r, 0); ctx.stroke();
        ctx.restore();

        drawPlayer(p1);
        drawPlayer(bot);

        update();
        requestAnimationFrame(draw);
    }

    draw();
</script>
</body>
</html>